$(document).ready(function(){
    $(document).on('click', '.tabs .tab:not(.selected)', function() {
        var tabs = $(this).closest('.tabs')
        var tab_old_selected = tabs.find('.selected');
        var tab_new_selected = $(this);

        if (tabs.hasClass('boxes')){
            var ramka = tabs.closest('.ramka');
            var box = $(this).attr('data-box');

            ramka.find('.dane[data-box="'+tab_old_selected.attr('data-box')+'"]').hide();
            ramka.find('.dane[data-box="'+tab_new_selected.attr('data-box')+'"]').show();
        }

        tabs.find('.selected').removeClass('selected');
        $(this).addClass('selected');
    });

    $(document).on('click', '.window-shop-select-tab:not(.selected)', function() {
        var tab_new_selected = $(this);

        
        var box_windows = $(this).closest('.shop').find('.windows-shop');
        
        box_windows.children('div').each(function() {
            var show_windows_indexes = $(this).attr('data-indexes').split(',');
            if (show_windows_indexes.includes(tab_new_selected.attr('data-window-index'))){
                $(this).show();
            } else {
                $(this).hide();
            }
        })

        $('.window-shop-select-tab.selected').removeClass('selected');
        $(this).addClass('selected');
    });

    $(document).on('click', '.nt-slot-item.checkable', function() {
        $(this).toggleClass('selected');
    });
});

$(document).on('mouseenter', '.hover-show-name', function() {
    var attr = $(this).attr('data-name');
    if (typeof attr !== 'undefined' && attr !== false) {
        if (attr.includes("X_PLUS_X")){
            if (typeof $(this).attr('data-plus') !== 'undefined' && Number($(this).attr('data-plus')) > 0){
                attr = attr.replace("X_PLUS_X", " +" + $(this).attr('data-plus'));
            } else {
                attr = attr.replace("X_PLUS_X", "");
            }
        }

        $('#hover-element-name').html(attr);
        setPositionToHoverElement($('#hover-element-name'), $(this));
        $('#hover-element-name').css('visibility', 'visible')
    }
});

$(document).on('mouseleave', '.hover-show-name', function() {
    $('#hover-element-name').css('visibility', 'hidden');
});


function setPositionToHoverElement(element, hover_element){
    var element_width = parseInt(element.outerWidth());
    var element_height = parseInt(element.outerHeight());

    var left = parseInt(hover_element.offset().left) - parseInt($("#divStrona").offset().left);
    var top = parseInt(hover_element.offset().top) - parseInt($("#divStrona").offset().top);
    
    var position_top = top - element_height;

    var main_end_point = parseInt($("#divStrona").width());

    if (main_end_point < left + element_width){
        element.css('left', '');
        element.css('right', '0');
    } else {
        element.css('left', left);
        element.css('right', '');
    }

    element.css('top', position_top);
}



//minimap zoom
$(document).ready(function(){
    $(document).on('click', '.window-minimap.zoomable', function(){
        if (!$('#zoomed-minimap').length){
            $('body').append('<div id="zoomed-minimap" data-id="-1"></div>');
        }

        if ($(this).attr('data-id') == $('#zoomed-minimap').attr('data-id')){
            $('#zoomed-minimap').show();
        } else {
            $('#zoomed-minimap').attr('data-id', $(this).attr('data-id'));

            var map = $(this).find('.map');
            var zoomed_map_src = map.attr('src').replace('mini-maps', 'custom_maps').replace('.png', '.jpg');

            var map_width = map.width() * parseFloat($(this).attr('multipler'));
            var map_height = map.height() * parseFloat($(this).attr('multipler'));
            var map_offset_x = parseFloat($(this).attr('offset-x'));
            var map_offset_y = parseFloat($(this).attr('offset-y'));
            var map_left = parseFloat(map.css('left'));
            var map_top = parseFloat(map.css('top'));
            var zoomed_width = $(this).attr('custom-big-x');
            var zoomed_height = $(this).attr('custom-big-y');
            $('#zoomed-minimap').html('<div id="zoomed-minimap-map" style="width:'+zoomed_width+'px; height:'+zoomed_height+'px"><img src="'+zoomed_map_src+'"/></div>')

            $(this).find('.minimap-point').each(function() {
                var zoomed_left = (parseFloat($(this).css('left')) - map_left - map_offset_x) / map_width * 100;
                var zoomed_top = (parseFloat($(this).css('top')) - map_top - map_offset_y) / map_height * 100;
                var npc_class = $(this).hasClass('minimap-point-npc') ? 'zoomed-map-point-npc' : '';
                $('#zoomed-minimap-map').append('<div class="zoomed-map-point '+ npc_class +'" style="left:'+zoomed_left+'%; top:'+zoomed_top+'%"></div>')
            })

            $('#zoomed-minimap').show();
        }
    });

    $(document).on('click', '#zoomed-minimap', function(){
        $('#zoomed-minimap').hide();
    });
});